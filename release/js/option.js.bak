$(document).ready(function(){for(addpassword=function(s,a){stealth=localStorage["password_"+s+"_salt"]||"",storestr="none"==localStorage["password_"+s+"_type"]?"No password is stored":"Stored as <em>"+localStorage["password_"+s+"_type"]+"</em>",$("#saved_passwords").append($("<ul/>",{id:"password_"+s,"class":"added"}).append($("<li/>").text(localStorage["password_"+s+"_name"]||""),$("<li/>").text(localStorage["password_"+s+"_length"]||""),$("<li/>").html(storestr),$("<li/>").text(stealth.length>0?"With Stealth":" "),$("<li/>").append($("<button/>",{"class":"delete"}).text("Delete Password")))),"undefined"!=typeof a?$("#password_"+s).hide().animate({height:"toggle",opacity:"toggle"},500,function(){$(this).removeClass("added")}):$("#password_"+s).removeClass("added")},passes=JSON.parse(localStorage.passwords||"[]"),i=0;i<passes.length;++i)addpassword(passes[i]);$("#length").change(function(){$("#range_val label").text($(this).val())}).keydown(function(s){37==s.keyCode?($(this).val(parseInt($(this).val())-1),$("#range_val label").text($(this).val())):39==s.keyCode&&($(this).val(parseInt($(this).val())+1),$("#range_val label").text($(this).val()))}).click(function(){$(this).focus()}),$(".reveal").click(function(){$(this).next("input").get(0).type="password"==$(this).next("input").attr("type")?"text":"password"}),$("#buttonset button").click(function(){$("#buttonset button").removeClass("toggle").filter(this).addClass("toggle"),"none"==$(this).attr("id")?$("#password").attr("disabled","disabled"):$("#password").removeAttr("disabled")}),$("#buttonset button, #stealth").bind("mouseenter focus",function(){$("#"+this.id+"_answer").fadeIn(250)}).bind("mouseleave blur",function(){$("#"+this.id+"_answer").fadeOut(250)}).mousemove(function(s){$(".answer_box").css({left:s.pageX})}),$(document).on("click","#saved_passwords .delete",function(){id=$(this).parents("ul").addClass("deleted").fadeOut(500,function(){$(this).remove()}).attr("id"),delete localStorage[id+"_name"],delete localStorage[id+"_type"],delete localStorage[id+"_length"],delete localStorage[id+"_password"],delete localStorage[id+"_salt"],passes=JSON.parse(localStorage.passwords),val=id.replace("password_",""),passes=passes.filter(function(s){return s!=val}),localStorage.passwords=JSON.stringify(passes)}),$("#save").click(function(){if(i=b64_md5($("#name").val()).substring(0,5)||"scpg"+Math.floor(100*Math.random()),localStorage.passwords&&localStorage.passwords.indexOf('"'+i+'"')>0)return $("#name").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1;switch("string"!=typeof localStorage.passwords?localStorage.passwords=JSON.stringify([i]):(passes=JSON.parse(localStorage.passwords),passes.push(i),localStorage.passwords=JSON.stringify(passes)),localStorage["password_"+i+"_name"]=$("#name").val()||"My Password",localStorage["password_"+i+"_type"]=$("#buttonset .toggle:first").attr("id"),localStorage["password_"+i+"_length"]=$("#length").val()||10,localStorage["password_"+i+"_type"]){case"hash":localStorage["password_"+i+"_password"]=b64_md5($("#password").val());break;case"session":var s=chrome.extension.getBackgroundPage();s.session_password=$("#password").val();break;case"always":localStorage["password_"+i+"_password"]=$("#password").val()}$("#stealth").val().length>0&&(localStorage["password_"+i+"_salt"]=$("#stealth").val()),addpassword(i,!0)}),$("#notonload").click(function(){var s=JSON.parse(localStorage.options||"{}");$(this).is(":checked")?s.notonload=!1:s.notonload=!0,localStorage.options=JSON.stringify(s)}),$("#key_key").keyup(function(s){var a=JSON.parse(localStorage.options||"{}");a.key_key=this.value,localStorage.options=JSON.stringify(a)});var s=JSON.parse(localStorage.options||"{}");$("#key_key").val(s.key_key||"P"),s.notonload?$("#notonload").removeAttr("checked","checked"):$("#notonload").attr("checked","checked")});