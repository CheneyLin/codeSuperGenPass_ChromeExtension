$(document).ready(function(){for(addpassword=function(s,a){stealth=localStorage["password_"+s+"_salt"]||"",storestr="none"==localStorage["password_"+s+"_type"]?"No password is stored":"Stored as <em>"+localStorage["password_"+s+"_type"]+"</em>";var e="******************************************";storestr=localStorage["password_"+s+"_password"],storestr2=e.substring(0,storestr.length),stealth.length>0&&(storestr+=" + "+stealth,storestr2+="<b>stealth</b>"),$("#panel_list").append($("<div/>",{id:"password_"+s,"class":"card added"}).append($("<div/>",{"class":"title"}).html("<i>Profile Name</i><br>"+localStorage["password_"+s+"_name"]||""),$("<div/>",{"class":"length"}).html(localStorage["password_"+s+"_length"]||""),$("<div/>",{"class":"storestr"}).html('<i>Master Password</i><br><div title="'+storestr+'">'+storestr2+"</div>"),$("<div/>",{"class":"stealth"}).html("<i>Password Stealth</i><br>"+stealth.length>0?"With Stealth":" "),$("<div/>",{"class":"action"}).append($("<button/>",{"class":"delete"}).text("Delete Password")))),"undefined"!=typeof a?$("#password_"+s).hide().animate({height:"toggle",opacity:"toggle"},500,function(){$(this).removeClass("added")}):$("#password_"+s).removeClass("added")},passes=JSON.parse(localStorage.passwords||"[]"),i=0;i<passes.length;++i)addpassword(passes[i]);$("#lengthadjust").change(function(){$("#range_val").text($(this).val())}).keydown(function(s){37==s.keyCode?($(this).val(parseInt($(this).val())-1),$("#range_val").text($(this).val())):39==s.keyCode&&($(this).val(parseInt($(this).val())+1),$("#range_val").text($(this).val()))}).click(function(){$(this).focus()}),$(".reveal").click(function(){$(this).prev("input").get(0).type="password"==$(this).prev("input").attr("type")?"text":"password"}),$("#buttonset button").click(function(){$("#buttonset button").removeClass("toggle").filter(this).addClass("toggle"),"none"==$(this).attr("id")?$("#password").attr("disabled","disabled"):$("#password").removeAttr("disabled")}),$(document).on("click","#panel_list .delete",function(){id=$(this).parents("div.card").addClass("deleted").fadeOut(500,function(){$(this).remove()}).attr("id"),delete localStorage[id+"_name"],delete localStorage[id+"_type"],delete localStorage[id+"_length"],delete localStorage[id+"_password"],delete localStorage[id+"_salt"],passes=JSON.parse(localStorage.passwords),val=id.replace("password_",""),passes=passes.filter(function(s){return s!=val}),localStorage.passwords=JSON.stringify(passes)}),$("#save").click(function(){return""==$("#name").val()?($("#name").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):""==$("#password").val()?($("#password").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):(i=b64_md5($("#name").val()).substring(0,5)||"scpg"+Math.floor(100*Math.random()),localStorage.passwords&&localStorage.passwords.indexOf('"'+i+'"')>0?($("#name").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):("string"!=typeof localStorage.passwords?localStorage.passwords=JSON.stringify([i]):(passes=JSON.parse(localStorage.passwords),passes.push(i),localStorage.passwords=JSON.stringify(passes)),localStorage["password_"+i+"_name"]=$("#name").val()||"My Password",localStorage["password_"+i+"_length"]=$("#lengthadjust").val()||10,localStorage["password_"+i+"_type"]="always",localStorage["password_"+i+"_password"]=$("#password").val(),$("#stealth").val().length>0&&(localStorage["password_"+i+"_salt"]=$("#stealth").val()),addpassword(i,!0),$("#name").val("My Password"),$("#password").val(""),void $("#stealth").val("")))}),$("#notonload").click(function(){var s=JSON.parse(localStorage.options||"{}");$(this).is(":checked")?s.notonload=!1:s.notonload=!0,localStorage.options=JSON.stringify(s)}),$("#key_key").keyup(function(s){$("#key_key").val(String.fromCharCode(s.which));var a=JSON.parse(localStorage.options||"{}");a.key_key=String.fromCharCode(s.which),localStorage.options=JSON.stringify(a)});var s=JSON.parse(localStorage.options||"{}");$("#key_key").val(s.key_key||"P"),s.notonload?$("#notonload").removeAttr("checked","checked"):$("#notonload").attr("checked","checked")});