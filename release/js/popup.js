function selectText(e){var s=document.getElementById(e);if(document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(s),a.select()}else if(window.getSelection){var t=window.getSelection(),a=document.createRange();a.selectNodeContents(s),t.removeAllRanges(),t.addRange(a)}}function genPass(e){if($("#hint,#hint2,#genpasswd_text").stop().hide(),sendPass||e?(sendPass=Pass.init(e),""==sendPass.password()&&sendPass.password($("#password").val()),pass=sendPass.generate($("#domain").val(),$("#disabletld").is(":checked"))):pass=SGPLocal($("#password").val(),$("#domain").val(),$("#disabletld").is(":checked"),10,null),options.special_characters){var s="~!@#%^&*()_+=-[]|}{",a=pass.pass,t=a.substring(0,a.length-2),i=s.charAt(a.charCodeAt(a.length-2)%s.length),n=s.charAt(a.charCodeAt(a.length-1)%s.length);pass.pass=t+i+n}$("#genpasswd").val(pass.pass);var d=pass.pass.replace(/([+\-]?[0-9]+(\.[0-9]+)?)/g,"<i>$1</i>");$("#genpasswd_text").html(d),$("#generated").slideDown(250).delay(250),$("#hint").delay(250).fadeIn(400).delay(3e3).fadeOut(400),$("#regen").removeAttr("disabled"),chrome.tabs.getSelected(null,function(e){chrome.tabs.sendRequest(e.id,{type:"set",value:$("#genpasswd").val()},function(){})})}var passid=!1,sendPass=!1,passes=JSON.parse(localStorage.passwords||"[]"),options=JSON.parse(localStorage.options||"{}");$(document).ready(function(){$("#popup_title").html(chrome.i18n.getMessage("popup_title")),$("#popup_disable_subdomain_removal").html(chrome.i18n.getMessage("popup_disable_subdomain_removal")),$("#dscr").html(chrome.i18n.getMessage("popup_master_password")),$("#popup_your_generated_password").html(chrome.i18n.getMessage("popup_your_generated_password")),$("#popup_domain_name").html(chrome.i18n.getMessage("popup_domain_name")),$("#regen").html(chrome.i18n.getMessage("popup_generate")),$("#popup_list_title").html(chrome.i18n.getMessage("popup_list_title")),1==passes.length?$("#hint").html(chrome.i18n.getMessage("popup_gen_hint_default")+"<div></div>"):$("#hint").html(chrome.i18n.getMessage("popup_gen_hint")+"<div></div>"),$("#hint2").html(chrome.i18n.getMessage("popup_gen_hint2")+"<div></div>"),chrome.tabs.getSelected(null,function(e){$("#domain").val(gp2_process_uri(e.url,!1)),$("#domainh").val(e.url),0==passes.length?($("#master_input").show(),$("#regen").removeClass("forbit"),$("#scp_list_title").hide(),$("#scp_list").hide(),passid=null):1==passes.length?($("#scp_list_title").hide(),$("#scp_list").hide(),passid=passes[0],sendPass=Pass.init(passid),""==sendPass.password()?$("#master_input").slideDown(250):genPass(passes[0])):($("#master_input").hide(),$("#regen").addClass("forbit"),$("#scp_list_title").show(),$("#scp_list").show(),$.each(passes,function(e,s){$("#scp_list").append($("<li/>",{id:s,text:localStorage["password_"+s+"_name"]}).click(function(){passid=this.id,$("#genpasswd").val(""),$(this).siblings().removeClass("active"),$(this).addClass("active"),sendPass=Pass.init(passid),sendPass.password()===!1||""==sendPass.password()?($("#master_input").slideDown(250),$("#password").focus().select()):($("#master_input").slideUp(250),genPass(passid))}))})),$("#password").focus()}),$("#disabletld").click(function(){$("#domain").trigger("blur")}),$("#domain,#password").focus(function(){$(this).addClass("focuson")}).blur(function(){$(this).removeClass("focuson")}),$("#domain").change(function(){}).blur(function(){$("#domain").val(gp2_process_uri($("#domain").val(),$("#disabletld").is(":checked"))),$("#password").focus()}),$("#password").keyup(function(e){this.value.length>0?$("#regen").removeAttr("disabled"):$("#regen").attr("disabled","disabled"),"hash"==sendPass.type&&(console.log("yay"),b64_md5($(this).val())==sendPass.generate().pass?$(this).addClass("good").removeClass("bad"):$(this).addClass("bad").removeClass("good")),13==e.keyCode&&$("#regen").click()}),$("#genpasswd").click(function(){console.log("click"),$("#genpasswd_text").fadeIn(250).delay(5e3).fadeOut(400),selectText("genpasswd_text"),document.execCommand("Copy"),$("#hint").hide(),$("#hint2").fadeIn(400).delay(3e3).fadeOut(400)}),$("#regen").attr("disabled","disabled").click(function(){genPass(passid)}),$("body").keyup(function(e){if(40==e.keyCode)next=$("#scp_list li.over").next().length>0?$("#scp_list li.over").next():$("#scp_list li").first(),$("#scp_list li").removeClass("over").filter(next).addClass("over");else if(38==e.keyCode)prev=$("#scp_list li.over").prev().length>0?$("#scp_list li.over").prev():$("#scp_list li").last(),$("#scp_list li").removeClass("over").filter(prev).addClass("over");else if(13==e.keyCode)return $("#scp_list .over").click(),!1})});