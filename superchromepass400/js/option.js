$(document).ready(function(){for($("#option_list_title").html(chrome.i18n.getMessage("option_list_title")),$("#option_list_password").html(chrome.i18n.getMessage("option_list_password")),$("#option_list_stealth").html(chrome.i18n.getMessage("option_list_stealth")),$("#name").val(chrome.i18n.getMessage("option_list_title_newpassword")),$("#save").html(chrome.i18n.getMessage("option_input_title")),$("#option_general_options").html(chrome.i18n.getMessage("option_general_options")),$("#option_auto_form_label").html(chrome.i18n.getMessage("option_auto_form_label")),$("#option_special_characters_label").html(chrome.i18n.getMessage("option_special_characters_label")),$("#option_shortcut_key").html(chrome.i18n.getMessage("option_shortcut_key")),$("#option_shortcut_key_label").html(chrome.i18n.getMessage("option_shortcut_key_label")),addpassword=function(e,t){stealth=localStorage["password_"+e+"_salt"]||"",storestr="none"==localStorage["password_"+e+"_type"]?"No password is stored":"Stored as <em>"+localStorage["password_"+e+"_type"]+"</em>";var s="******************************************";storestr=localStorage["password_"+e+"_password"],storestr2=s.substring(0,storestr.length),stealth.length>0&&(storestr+=" + "+stealth,storestr2+="<b>stealth</b>"),$("#panel_list").append($("<div/>",{id:"password_"+e,"class":"card added"}).append($("<div/>",{"class":"title"}).html("<i>"+chrome.i18n.getMessage("option_list_title")+"</i><br>"+localStorage["password_"+e+"_name"]||""),$("<div/>",{"class":"length"}).html(localStorage["password_"+e+"_length"]||""),$("<div/>",{"class":"storestr"}).html("<i>"+chrome.i18n.getMessage("option_list_password")+'</i><br><div title="'+storestr+'">'+storestr2+"</div>"),$("<div/>",{"class":"stealth"}).html("<i>"+chrome.i18n.getMessage("option_list_stealth")+"</i><br>"+stealth.length>0?"With Stealth":" "),$("<div/>",{"class":"action"}).append($("<button/>",{"class":"delete"}).text(chrome.i18n.getMessage("option_del_title"))))),"undefined"!=typeof t?$("#password_"+e).hide().animate({height:"toggle",opacity:"toggle"},500,function(){$(this).removeClass("added")}):$("#password_"+e).removeClass("added")},passes=JSON.parse(localStorage.passwords||"[]"),i=0;i<passes.length;++i)addpassword(passes[i]);$("#lengthadjust").change(function(){$("#range_val").text($(this).val())}).keydown(function(e){37==e.keyCode?($(this).val(parseInt($(this).val())-1),$("#range_val").text($(this).val())):39==e.keyCode&&($(this).val(parseInt($(this).val())+1),$("#range_val").text($(this).val()))}).click(function(){$(this).focus()}),$(".reveal").click(function(){$(this).prev("input").get(0).type="password"==$(this).prev("input").attr("type")?"text":"password"}),$("#buttonset button").click(function(){$("#buttonset button").removeClass("toggle").filter(this).addClass("toggle"),"none"==$(this).attr("id")?$("#password").attr("disabled","disabled"):$("#password").removeAttr("disabled")}),$(document).on("click","#panel_list .delete",function(){id=$(this).parents("div.card").addClass("deleted").fadeOut(500,function(){$(this).remove()}).attr("id"),delete localStorage[id+"_name"],delete localStorage[id+"_type"],delete localStorage[id+"_length"],delete localStorage[id+"_password"],delete localStorage[id+"_salt"],passes=JSON.parse(localStorage.passwords),val=id.replace("password_",""),passes=passes.filter(function(e){return e!=val}),localStorage.passwords=JSON.stringify(passes)}),$("#save").click(function(){return""==$("#name").val()?($("#name").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):""==$("#password").val()?($("#password").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):(i=b64_md5($("#name").val()).substring(0,5)||"scpg"+Math.floor(100*Math.random()),localStorage.passwords&&localStorage.passwords.indexOf('"'+i+'"')>0?($("#name").focus().addClass("bad").keyup(function(){$(this).removeClass().unbind("keyup")}),!1):("string"!=typeof localStorage.passwords?localStorage.passwords=JSON.stringify([i]):(passes=JSON.parse(localStorage.passwords),passes.push(i),localStorage.passwords=JSON.stringify(passes)),localStorage["password_"+i+"_name"]=$("#name").val()||"My Password",localStorage["password_"+i+"_length"]=$("#lengthadjust").val()||10,localStorage["password_"+i+"_type"]="always",localStorage["password_"+i+"_password"]=$("#password").val(),$("#stealth").val().length>0&&(localStorage["password_"+i+"_salt"]=$("#stealth").val()),addpassword(i,!0),$("#name").val("My Password"),$("#password").val(""),void $("#stealth").val("")))}),$("#notonload").click(function(){var e=JSON.parse(localStorage.options||"{}");$(this).is(":checked")?e.notonload=!1:e.notonload=!0,localStorage.options=JSON.stringify(e)}),$("#special_characters").click(function(){var e=JSON.parse(localStorage.options||"{}");$(this).is(":checked")?e.special_characters=!0:e.special_characters=!1,localStorage.options=JSON.stringify(e)}),$("#include_identicon").click(function(){var e=JSON.parse(localStorage.options||"{}");$(this).is(":checked")?e.include_identicon=!0:e.include_identicon=!1,localStorage.options=JSON.stringify(e)}),$("#key_key").keyup(function(e){$("#key_key").val(String.fromCharCode(e.which));var t=JSON.parse(localStorage.options||"{}");t.key_key=String.fromCharCode(e.which),localStorage.options=JSON.stringify(t)});var e=JSON.parse(localStorage.options||"{}");$("#key_key").val(e.key_key||"P"),e.notonload?$("#notonload").removeAttr("checked","checked"):$("#notonload").attr("checked","checked"),e.special_characters?$("#special_characters").attr("checked","checked"):$("#special_characters").removeAttr("checked","checked"),e.include_identicon?$("#include_identicon").attr("checked","checked"):$("#include_identicon").removeAttr("checked","checked")});